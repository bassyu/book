# npm

### 자주 사용하는 명령어

#### npm publish

npm 레지스트리로 패키지를 배포합니다. 
특별한 설정이 없다면 .gitignore와 .npmignore 파일을 제외한 모든 파일이 배포에 포함되며, 배포된 패키지는 npm install 명령어로 외부에서 설치할 수 있습니다.

```shell
$ npm publish
```

#### npx

npx는 npm 5.2 버전부터 기본으로 제공되는 패키지 실행 도구입니다.
npx를 사용하면 패키지를 설치하지 않고 최신 버전의 패키지를 가져와 실행할 수 있습니다.
불필요한 패키지 설치를 하지 않고도 항상 최신 버전의 패키지 실행을 기대할 수 있는 것입니다.

예를 들어 npx를 통해 create-react-app을 설치할 경우 매번 최신 버전으로 가져와서 설치하기 때문에 버전 업데이트에 신경 쓰지 않고 편리하게 패키지의 명령어를 실행할 수 있습니다.

## package.json의 중요한 속성들

#### name

npm 레지스트리에 배포할 경우 사용될 패키지의 이름입니다.

#### main

패키지를 설치한 곳에서 진입점으로 사용할 파일을 지정합니다.
만약 main 을 index.js로 정의하면 해당 패키지를 설치하여 사용하는 곳에서는 자동으로 index.js를 진입점으로 가져와 사용하게 됩니다.

## 의존성 버전과 semantic versioning

npm의 패키지는 일반적으로 **semantic versioning**이란 규칙을 따릅니다.

**X.Y.Z** 형태를 보여야 하며 X, Y, Z는 양의 정수여야 합니다.
X는 메이저(major) 버전, Y는 마이너(minor) 버전, Z는 패치(patch) 버전을 의미하며, 각 버전 요소는 1씩 증가해야 합니다.

#### 각 버전 요소의 의미

- major : 프로젝트 전반적인 큰 구조 변경 또는 기존의 API, 옵션과 호완되지 않는 변경 사항이 있을 경우 메이저 버전을 증가시킵니다. 사용자 측에서 많은 변경이 필요하기 때문에 마이그레이션 가이드 또는 스크립트를 같이 제공해주는 경우가 많습니다. 
- minor : 하위 버전과 호환되는 기능을 추가할 때 마이너 버전을 증가시킵니다.
- patch : 이전 버전과 호환되는 버그 수정을 할 때 패치 버전을 증가시킵니다.

#### 캐럿

패키지의 버전 앞에 캐럿이 붙었다면 0이 아닌 버전 요소 중 가장 왼쪽에 있는 요소를 수정하지 않는 범위에서 패키지를 설치합니다.

| 캐럿 버전 표기 | 버전 범위 |
| - | - |
| ^1.2.3 | 1.2.3 <= 버전 < 2.0.0 |
| ^0.2.3 | 0.2.3 <= 버전 < 0.3.0 |
| ^0.0.3 | 0.0.3 == 버전 |

#### 틸드

마이너 버전이 지정된 경우에는 패치 버전에 대한 업데이트만 허용합니다.


| 틸드 버전 표기 | 버전 범위 |
| - | - |
| ~1.2.3 | 1.2.3 <= 버전 < 1.3.0 |
| ~1.2 | 1.2.3 <= 버전 < 1.3.0 |
| ~1 | 1.0.0 <>= 버전 < 2.0.0 |

#### 버전 고정

package.json에서 틸드나 캐럿 없이 특정 버전으로 고정하여 패키지의 업데이트를 막을 수도 있습니다. 
하지만 보안이나 다른 패키지와의 호환 이슈가 없다면 거의 사용하지 않습니다.

## package-lock.json 파일의 중요성

예를들어 vue 패키지가 "vue": "^2.5.0" 이라고 등록되어 있으면 2.5.0 이상 3.0.0 미만으로 패키지 설치 범위가 지정됩니다. 
한 프로젝트에 여러 개발자가 시간차에 의해 서로 다른 버전의 패키지를 설치한다면 큰 혼선이 발생할 수 있습니다.

npm은 이러한 문제를 해결하기 위해 패키지의 의존성 트리를 잠금하는 package-lock.json 파일을 도입하였습니다. 
**package-lock.json은 설치 시점 당시의 의존성 트리 정보를 저장하고 있으며, 이 파일이 있다면 npm은 이 파일의 의존성 트리를 기준으로 패키지를 설치**합니다.

### npm ci 명령어

CI(Continuous Integration) 환경에서 통합 환경 구축을 위해 등장한 명령어로 npm 5.7.0 버전 이상부터 사용할 수 있습니다.
npm ci 명령어는 package-lock.json 파일을 바라보고 패키지를 설치합니다.
그렇기 때문에 반드시 package-lock.json 파일이 프로젝트에 존재해야 합니다.
또한 **개별 패키지는 설치할 수 없으며 전체 의존성 패키지를 설치할 때만 사용**할 수 있습니다.

npm ci 명령어는 package-lock.json 파일만 바라보고 패키지를 설치하기 때문에 훨신 빠릅니다.

npm ci 명령어는 package.json과 package-lock.json 파일의 버전 정보와 다를 경우, 오류를 발생시키기 때문에 안정적으로 버전을 관리할 수 있습니다.